(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["damage"],{"2b41":function(t,e,a){"use strict";var r=a("c812"),s=a.n(r);s.a},5471:function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-container",{attrs:{fluid:""}},[a("v-form",{ref:"damageForm",staticClass:"custom-form",on:{submit:function(e){return e.preventDefault(),t.saveDamage(e)}}},[a("v-row",{attrs:{dense:""}},[a("v-col",{attrs:{cols:"8"}},[a("v-row",{attrs:{dense:""}},[a("v-col",{attrs:{cols:"8"}},[a("v-card",{staticClass:"white shadow1 rounded mb-5 pb-4"},[a("v-toolbar",{attrs:{color:"white",elevation:0}},[a("v-toolbar-title",{staticClass:"subtitle-1"},[t._v("Product Information")])],1),a("v-card-text",{staticClass:"py-1"},[a("v-form",{ref:"productForm",staticClass:"custom-form",on:{submit:function(e){return e.preventDefault(),t.addToCart(e)}}},[a("v-row",{staticClass:"mb-2"},[a("v-col",{staticClass:"py-1",attrs:{cols:"3"}},[t._v("Product")]),a("v-col",{staticClass:"py-0",attrs:{cols:"9"}},[a("v-combobox",{ref:"product",attrs:{dense:"",outlined:"","hide-details":"",items:t.$store.getters["product/products"],loading:t.$store.getters["product/loadingProducts"],"item-text":"display_text","item-value":"id"},on:{focus:function(e){return t.$store.dispatch("product/getProducts")}},model:{value:t.product,callback:function(e){t.product=e},expression:"product"}})],1)],1),a("v-row",{staticClass:"mb-2"},[a("v-col",{staticClass:"py-1",attrs:{cols:"3"}},[t._v("Damage Rate")]),a("v-col",{staticClass:"py-0",attrs:{cols:"4"}},[a("v-text-field",{attrs:{dense:"",outlined:"","hide-details":"",type:"number",min:"0"},on:{input:t.productTotal},model:{value:t.product.purchase_rate,callback:function(e){t.$set(t.product,"purchase_rate",t._n(e))},expression:"product.purchase_rate"}})],1),a("v-col",{staticClass:"py-0 pa-0 d-flex",staticStyle:{"align-items":"center"},attrs:{cols:"2"}},[t._v("Quantity")]),a("v-col",{staticClass:"py-0 pa-0 pr-3",attrs:{cols:"3"}},[a("v-text-field",{ref:"quantity",attrs:{dense:"",outlined:"","hide-details":"",type:"number",min:"0"},on:{input:t.productTotal},model:{value:t.product.quantity,callback:function(e){t.$set(t.product,"quantity",t._n(e))},expression:"product.quantity"}})],1)],1),a("v-row",{staticClass:"mb-2",staticStyle:{"align-items":"center"}},[a("v-col",{staticClass:"py-1",attrs:{cols:"3"}},[t._v("Damage Total")]),a("v-col",{staticClass:"py-0",attrs:{cols:"6"}},[a("v-text-field",{attrs:{dense:"",outlined:"","hide-details":"",type:"number",min:"0",readonly:""},model:{value:t.product.total,callback:function(e){t.$set(t.product,"total",e)},expression:"product.total"}})],1),a("v-col",{staticClass:"py-0 pa-0 pr-3",attrs:{cols:"3"}},[a("v-btn",{attrs:{block:"",type:"submit",dark:"",color:"light-blue darken-2"}},[t._v("Add")])],1)],1)],1)],1)],1)],1),a("v-col",{attrs:{cols:"4"}},[a("v-card",{staticClass:"white shadow1 rounded pb-3",staticStyle:{"min-height":"200px"}},[a("v-toolbar",{staticStyle:{"border-bottom":"1px solid #ddd"},attrs:{elevation:0,height:"50px"}},[a("v-toolbar-title",{staticClass:"subtitle-1 text-center"},[t._v("Product Stock")])],1),a("v-card-text",{staticClass:"py-1"},[a("div",{staticClass:"stock"},[t._v(" "+t._s(t.stock)+" ")])])],1)],1)],1),a("v-row",{attrs:{dense:""}},[a("v-col",{attrs:{cols:"12"}},[a("v-card",{staticClass:"px-0",attrs:{elevation:1}},[a("v-toolbar",{attrs:{color:"white",elevation:0,height:"50px"}},[a("v-toolbar-title",{staticClass:"subtitle-2"},[t._v("Cart Information")])],1),a("v-card-text",{staticClass:"py-1 pa-0 pl-1 pr-1"},[a("v-simple-table",{scopedSlots:t._u([{key:"default",fn:function(){return[a("thead",[a("tr",[a("th",[t._v("SL")]),a("th",[t._v("Product Name")]),a("th",[t._v("Damage Rate")]),a("th",[t._v("Quantity")]),a("th",[t._v("Total")]),a("th",[t._v("Action")])])]),a("tbody",t._l(t.cart,(function(e,r){return a("tr",{key:r},[a("td",{staticClass:"text-center",staticStyle:{width:"5%"}},[t._v(t._s(r+1))]),a("td",[t._v(t._s(e.name))]),a("td",{staticClass:"text-right",staticStyle:{width:"18%"}},[t._v(t._s(e.rate))]),a("td",{staticClass:"text-right",staticStyle:{width:"10%"}},[t._v(t._s(e.quantity))]),a("td",{staticClass:"text-right",staticStyle:{width:"10%"}},[t._v(t._s(e.total))]),a("td",{staticClass:"text-center",staticStyle:{width:"7%"}},[a("v-icon",{attrs:{small:"",color:"primary"},on:{click:function(e){return t.editCart(r)}}},[t._v("mdi-circle-edit-outline")]),a("v-icon",{attrs:{small:"",color:"error"},on:{click:function(e){return t.deleteCart(r)}}},[t._v("mdi-delete-circle-outline")])],1)])})),0)]},proxy:!0}])})],1)],1)],1)],1)],1),a("v-col",{attrs:{cols:"4"}},[a("v-row",{attrs:{"no-gutters":""}},[a("v-col",{attrs:{cols:"12"}},[a("v-card",{staticClass:"white shadow1 rounded",attrs:{elevation:0}},[a("v-toolbar",{staticStyle:{"border-bottom":"1px solid #ddd !important"},attrs:{color:"white",elevation:0,height:"50px"}},[a("v-toolbar-title",{staticClass:"subtitle-1"},[t._v("Invoice Information")])],1),a("v-card-text",{staticClass:"py-5 px-2"},[a("v-row",{attrs:{"no-gutters":""}},[a("v-col",{staticClass:"py-1",attrs:{cols:"3"}},[t._v("Invoice")]),a("v-col",{staticClass:"py-0",attrs:{cols:"9"}},[a("v-text-field",{attrs:{dense:"",outlined:"","hide-details":"",readonly:""},model:{value:t.damage.invoice,callback:function(e){t.$set(t.damage,"invoice",e)},expression:"damage.invoice"}})],1)],1),a("v-row",{attrs:{"no-gutters":""}},[a("v-col",{staticClass:"py-1",attrs:{cols:"3"}},[t._v("Date")]),a("v-col",{staticClass:"py-0",attrs:{cols:"9"}},[a("v-menu",{scopedSlots:t._u([{key:"activator",fn:function(e){var r=e.on,s=e.attrs;return[a("v-text-field",t._g(t._b({attrs:{dense:"",outlined:"","hide-details":"",autocomplete:"off"},model:{value:t.damage.date,callback:function(e){t.$set(t.damage,"date",e)},expression:"damage.date"}},"v-text-field",s,!1),r),[a("v-icon",{attrs:{slot:"prepend-inner"},slot:"prepend-inner"},[t._v("mdi-calendar-month")])],1)]}}])},[a("v-date-picker",{model:{value:t.damage.date,callback:function(e){t.$set(t.damage,"date",e)},expression:"damage.date"}})],1)],1)],1),a("v-row",{attrs:{"no-gutters":""}},[a("v-col",{staticClass:"py-1",attrs:{cols:"3"}},[t._v("Note")]),a("v-col",{attrs:{cols:"9"}},[a("v-textarea",{attrs:{dense:"",outlined:"","hide-details":"","min-height":"12vh"},model:{value:t.damage.note,callback:function(e){t.$set(t.damage,"note",e)},expression:"damage.note"}})],1)],1),a("v-row",{attrs:{"no-gutters":""}},[a("v-col",{staticClass:"py-1",attrs:{cols:"3"}},[t._v("Total")]),a("v-col",{staticClass:"py-1",attrs:{cols:"9"}},[a("v-text-field",{attrs:{dense:"",outlined:"","hide-details":"",type:"number",min:"0",readonly:""},model:{value:t.damage.total,callback:function(e){t.$set(t.damage,"total",e)},expression:"damage.total"}})],1)],1),a("v-row",{attrs:{"no-gutters":""}},[a("v-col",{staticClass:"py-1",attrs:{cols:"3"}}),a("v-col",{staticClass:"py-1",attrs:{cols:"4"}},[a("v-btn",{attrs:{type:"submit",dark:"",block:"",color:"light-blue darken-2",loading:t.loading}},[t._v("Save")])],1),a("v-col",{staticClass:"pl-2 py-1",attrs:{cols:"5"}},[a("v-btn",{attrs:{dark:"",block:"",color:"deep-orange"}},[t._v("Clear")])],1)],1)],1)],1)],1)],1)],1)],1)],1)],1)},s=[],o=(a("99af"),a("c740"),a("4160"),a("d81d"),a("13d5"),a("a434"),a("b0c0"),a("b680"),a("b64b"),a("159b"),a("96cf"),a("1da1")),i=a("1940"),c=a.n(i),n={name:"Damage",data:function(){return{damage:{invoice:"",date:(new Date).toISOString().substr(0,10),note:"",total:0},product:{id:"",code:"",display_text:"Select product",name:"",purchase_rate:"",quantity:"",total:"",unit:{}},cart:[],editCartIndex:null,modal:!1,loading:!1,stock:""}},watch:{product:function(t){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(void 0!=t){a.next=2;break}return a.abrupt("return");case 2:return e.product=t,""!=t.id&&e.$refs.quantity.focus(),a.next=6,e.$store.dispatch("product/getCurrentStock",{productId:t.id});case 6:return a.next=8,e.$store.getters["product/stock"][0].current_quantity;case 8:e.stock=a.sent;case 9:case"end":return a.stop()}}),a)})))()}},created:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$store.dispatch("damage/generateDamageCode");case 2:if(t.damage.invoice=e.sent,void 0==t.$route.params.id){e.next=8;break}return e.next=6,t.$store.dispatch("damage/getDamages",{id:t.$route.params.id});case 6:return e.next=8,t.getDamage();case 8:case"end":return e.stop()}}),e)})))()},methods:{productTotal:function(){this.product.purchase_rate=null==this.product.purchase_rate||""==this.product.purchase_rate?0:this.product.purchase_rate,this.product.quantity=null==this.product.quantity||""==this.product.quantity?0:this.product.quantity,this.product.total=(+this.product.purchase_rate*+this.product.quantity).toFixed(2)},addToCart:function(){var t=this;if(this.$refs.productForm.validate())if(""!=this.product.id&&null!=this.product.id)if(0!=this.product.purchase_rate&&""!=this.product.purchase_rate&&null!=this.product.purchase_rate)if(0!=this.product.quantity&&""!=this.product.quantity&&null!=this.product.quantity)if(+this.product.quantity>+this.stock)this.$store.dispatch("snackbar/error","Product stock is insufficient");else{var e={id:this.product.id,code:this.product.code,name:this.product.name,rate:this.product.purchase_rate,quantity:this.product.quantity,total:this.product.total,display_text:this.product.display_text};if(null!=this.editCartIndex){var a=this.cart[this.editCartIndex],r=this.cart.findIndex((function(t){return t.id==e.id&&t.id!=a.id}));if(r>-1)return void this.$store.dispatch("snackbar/error","Product already existed in cart");this.cart[this.editCartIndex]=e}else{var s=this.cart.findIndex((function(e){return e.id==t.product.id}));if(s>-1)return void this.$store.dispatch("snackbar/error","Product already existed in cart");this.cart.unshift(e)}this.calculateTotal(),this.clearProduct(),this.$refs.product.focus()}else this.$store.dispatch("snackbar/error","damage quantity is required");else this.$store.dispatch("snackbar/error","damage rate is required");else this.$store.dispatch("snackbar/error","Select a product")},editCart:function(t){var e=this.cart[t];this.editCartIndex=t,this.product=e,this.product.purchase_rate=e.rate},deleteCart:function(t){this.cart.splice(t,1),this.calculateTotal()},calculateTotal:function(){this.damage.total=this.cart.reduce((function(t,e){return+t+ +e.total}),0).toFixed(2),console.log(this.damage.total)},clearProduct:function(){this.product={id:"",display_text:"",name:"",purchase_rate:"",quantity:"",total:""},this.editCartIndex=null,this.stock="",this.$refs.productForm.resetValidation()},saveDamage:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){var a,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.validatedamage()){e.next=2;break}return e.abrupt("return");case 2:return a={damage:t.damage,cart:t.cart},t.loadingForSave=!0,e.next=6,t.$store.dispatch("damage/saveDamage",a);case 6:r=e.sent,r&&r.isSuccess&&(t.resetForm(),c()({title:"Damage success! Do you want to show invoice ?",icon:"success",buttons:!0}).then((function(e){e&&t.$router.push("/damage-invoice/".concat(r.id))}))),t.loadingForSave=!1;case 9:case"end":return e.stop()}}),e)})))()},validatedamage:function(){var t=!0;if(this.$refs.damageForm.validate(),this.$refs.damageForm.inputs.forEach((function(e){e.hasError&&(t=!1)})),t)return 0==this.cart.length?(this.$store.dispatch("snackbar/error","Cart is empty"),t=!1,t):t},resetForm:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.cart=[],Object.keys(t.damage).map((function(e){return t.damage[e]=""})),t.$refs.damageForm.resetValidation(),t.damage.id=null,t.damage.date=(new Date).toISOString().substr(0,10),e.next=7,t.$store.dispatch("damage/generateDamageCode");case 7:t.damage.invoice=e.sent;case 8:case"end":return e.stop()}}),e)})))()},getDamage:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$store.getters["damage/damages"][0];case 2:a=e.sent,t.damage.id=a.id,t.damage.invoice=a.invoice,t.damage.date=a.date,t.damage.total=a.total,null===a||void 0===a||a.damage_details.forEach((function(e){t.cart.unshift({id:e.product.id,name:e.product.name,rate:e.rate,quantity:e.quantity,total:e.total,display_text:"".concat(e.product.code," - ").concat(e.product.name)})}));case 8:case"end":return e.stop()}}),e)})))()}}},d=n,l=(a("2b41"),a("2877")),u=a("6544"),p=a.n(u),v=a("8336"),h=a("b0af"),m=a("99d9"),f=a("62ad"),g=a("2b5d"),b=a("a523"),y=a("2e4b"),x=a("4bd4"),_=a("132d"),C=a("e449"),w=a("0fd9"),k=a("1f4f"),$=a("8654"),S=a("a844"),q=a("71d9"),D=a("2a7f"),T=Object(l["a"])(d,r,s,!1,null,"6b88bb98",null);e["default"]=T.exports;p()(T,{VBtn:v["a"],VCard:h["a"],VCardText:m["b"],VCol:f["a"],VCombobox:g["a"],VContainer:b["a"],VDatePicker:y["a"],VForm:x["a"],VIcon:_["a"],VMenu:C["a"],VRow:w["a"],VSimpleTable:k["a"],VTextField:$["a"],VTextarea:S["a"],VToolbar:q["a"],VToolbarTitle:D["a"]})},c812:function(t,e,a){}}]);
//# sourceMappingURL=damage.c47de716.js.map